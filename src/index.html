<!doctype html>
<html lang="tr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>TKM Miras</title>
    <!-- Font Awesome 6 (gelişmiş ikon seti) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="./styles.css">
    <!-- Intro.js (rehber turu) -->
    <link rel="stylesheet" href="../node_modules/intro.js/minified/introjs.min.css">
  </head>
  <body>
    <div id="trialBanner" style="display:none; background:#fff3cd; border-bottom:1px solid #ffc107; padding:12px 20px; text-align:center; font-weight:500; color:#856404; cursor:pointer;">
      <i class="fa-solid fa-hourglass-end"></i> <span id="trialText">30 gün deneme süresi - <strong id="trialDays">30</strong> gün kaldı</span>
      <span style="margin-left:15px; font-size:0.9em;">(Lisans için tıklayın)</span>
    </div>
    
    <!-- Lisans Aktivasyonu Modal -->
    <div id="licenseModal" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:9999; display:none; align-items:center; justify-content:center;">
      <div style="background:#fff; border-radius:12px; padding:20px; width:90%; max-width:400px; box-shadow:0 10px 40px rgba(0,0,0,0.3);">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
          <h2 data-key="licenseActivation" style="margin:0; font-size:1.2em;">Lisans Aktivasyonu</h2>
          <button id="closeLicense" style="background:none; border:none; font-size:1.5em; cursor:pointer; color:#999;">&times;</button>
        </div>
        <p data-key="licenseDesc" style="color:#666; margin:10px 0; font-size:0.95em;">Lisans anahtarınızı girerek uygulamayı etkinleştirin</p>
        <input id="licenseKeyInput" type="text" placeholder="Lisans Anahtarı" style="width:100%; padding:10px; border:2px solid #ddd; border-radius:6px; box-sizing:border-box; font-family:monospace; margin:10px 0;">
        <div style="display:flex; gap:10px; margin-top:15px;">
          <button id="activateLicenseBtn" class="btn primary" style="flex:1;" data-key="activateBtn">Aktivasyon Yap</button>
          <button id="cancelLicense" class="btn" style="flex:1; background:#999;" data-key="cancel">İptal</button>
        </div>
        <div id="licenseMsg" style="color:#dc2626; margin-top:10px; min-height:20px; font-size:0.9em;"></div>
      </div>
    </div>
    <div class="container">
      <header class="app-header">
        <div class="brand">
          <i class="fa-solid fa-balance-scale"></i>
          <div>
            <div class="title"><span data-key="title">Türk Medeni Kanunu Miras Hesaplayıcı</span></div>
            <div class="subtitle"><span data-key="subtitle">TMK Hükümlerine Göre Miras Dağılımını Hesapla</span></div>
          </div>
        </div>
        <div class="header-actions">
          <select id="dilSecici">
            <option value="tr">Türkçe</option>
            <option value="en">English</option>
          </select>
          <select id="temaSecici">
            <option value="light">Light</option>
            <option value="dark">Dark</option>
            <option value="blue">Blue</option>
            <option value="green">Green</option>
          </select>
          <button class="icon-btn" id="themeToggle"><i class="fa-regular fa-moon"></i></button>
          <button class="icon-btn" id="helpTour" title="Kılavuz"><i class="fa-regular fa-circle-question"></i></button>
        </div>
      </header>

      <section class="panel section">
        <div class="section-header"><i class="fa-solid fa-box-archive"></i> <span data-key="varliklar">Varlıklar</span></div>
        <div class="row form-row">
          <div class="input-group"><i class="fa-solid fa-tag"></i><input id="varlikAdi" placeholder="Varlık Adı (Örn: Ev, Banka)" /></div>
          <div class="input-group"><i class="fa-solid fa-coins"></i><select id="paraBirimi">
            <option value="TRY">TRY</option>
            <option value="USD">USD</option>
            <option value="EUR">EUR</option>
          </select></div>
          <div class="input-group"><i class="fa-solid fa-scale-balanced"></i><input id="kurInput" type="number" step="0.0001" value="1" placeholder="Kur (TL)" /></div>
          <div class="input-group"><i class="fa-solid fa-list"></i><select id="varlikTip">
            <option value="Taşınmaz">Taşınmaz</option>
            <option value="Nakit">Nakit</option>
            <option value="Menkul">Menkul</option>
            <option value="Araç">Araç</option>
            <option value="Takı">Takı</option>
            <option value="Hisse Senedi">Hisse Senedi</option>
            <option value="Diğer">Diğer</option>
          </select></div>
          <div class="input-group"><i class="fa-solid fa-lira-sign"></i><input id="varlikDeger" type="number" placeholder="Tutar (₺)" /></div>
          <div class="input-group"><i class="fa-solid fa-minus-circle"></i><input id="varlikBorc" type="number" placeholder="Borç (₺)" /></div>
          <button id="btnVarlik" class="btn primary"></button>
        </div>

        <ul id="varlikListe" class="list"></ul>
      </section>

      <section class="panel section">
        <div class="section-header"><i class="fa-solid fa-people-roof"></i> <span data-key="mirascilar">Mirasçılar</span></div>
        <div class="row form-row small">
          <label><i class="fa-solid fa-wand-magic-sparkles"></i> <span data-key="senaryo">Senaryo</span> 
            <select id="senaryoSecici">
              <option value="none" selected data-key="scenarioSelect">Seçin</option>
              <option value="es2cocuk" data-key="scenario1">Eş + 2 Çocuk</option>
              <option value="esAnneBaba" data-key="scenario2">Eş + Anne & Baba</option>
              <option value="kardes3" data-key="scenario3">Eş Yok + 3 Kardeş</option>
            </select>
          </label>
        </div>
        <div class="row form-row small">
          <label><i class="fa-solid fa-user"></i> <span data-key="esYasiyorMu">Eş yaşıyor mu?</span> <select id="es"><option value="evet" selected>Evet</option><option value="hayir">Hayır</option></select></label>
          <label><i class="fa-solid fa-child"></i> <span data-key="cocukSayisi">Çocuk sayısı</span> <input id="cocukSayisi" type="number" min="0" value="0" /></label>
          <label><i class="fa-solid fa-female"></i> <span data-key="anne">Anne:</span> <select id="anne"><option value="evet" selected>Evet</option><option value="hayir">Hayır</option></select></label>
          <label><i class="fa-solid fa-male"></i> <span data-key="baba">Baba:</span> <select id="baba"><option value="evet" selected>Evet</option><option value="hayir">Hayır</option></select></label>
          <label><i class="fa-solid fa-users"></i> <span data-key="kardesSayisi">Kardeş sayısı</span> <input id="kardesSayisi" type="number" min="0" value="0" /></label>
        </div>
        <!-- Ölen çocuklar için dinamik kontroller -->
        <div id="cocukOlumKontrolleri" style="background:#f5f5f5; padding:12px; border-radius:6px; margin-top:10px; display:none;"></div>
        <div id="cocuklar"></div>
        <div id="kardesler"></div>
      </section>

      <section class="panel actions">
        <div class="section-header"><i class="fa-solid fa-chart-bar"></i> <span data-key="sonuclar">Sonuçlar</span></div>
        <div class="row center">
          <button id="hesapla" class="btn big primary"></button>
        </div>

        <main id="sonucAlan"></main>

        <div class="row outputs">
          <input id="dosyaNo" placeholder="Dosya No" />
          <input id="mirasBirakan" placeholder="Miras Bırakan" />
          <input id="tcKimlik" placeholder="TC Kimlik" />
          <div class="input-group small"><i class="fa-solid fa-percent"></i>
            <input id="vergiSecici" type="number" min="0" step="0.1" value="5" placeholder="Vergi % (isteğe bağlı)" data-placeholder-key="taxPlaceholder">
          </div>
        </div>

        <div class="row actions-row">
          <button id="btnPDF" class="btn outline"></button>
          <button id="btnExcel" class="btn outline"></button>
          <button id="btnCSV" class="btn outline" data-key="csv">CSV</button>
          <button id="btnEDP" class="btn outline"></button>
          <button id="btnKaydet" class="btn outline"></button>
          <button id="btnYukle" class="btn outline"></button>
        </div>
        <input type="file" id="yukleInput" accept=".json" style="display:none">
        <div class="row filters">
          <div class="input-group small"><i class="fa-solid fa-filter"></i>
            <select id="mirasciFiltre">
              <option value="all" data-key="filterAll">Tümü</option>
            </select>
          </div>
          <div class="input-group small"><i class="fa-solid fa-arrow-down-a-z"></i>
            <select id="sonucSirala">
              <option value="name-asc" data-key="sortNameAsc">İsim A-Z</option>
              <option value="name-desc" data-key="sortNameDesc">İsim Z-A</option>
              <option value="pay-desc" data-key="sortPayDesc">Pay ↓</option>
              <option value="pay-asc" data-key="sortPayAsc">Pay ↑</option>
              <option value="tutar-desc" data-key="sortTutarDesc">Tutar ↓</option>
              <option value="tutar-asc" data-key="sortTutarAsc">Tutar ↑</option>
            </select>
          </div>
        </div>
      </section>

      <aside class="panel summary">
        <h3><span data-key="genelToplam">Genel Toplam</span></h3>
        <table id="toplamTablo">
          <thead>
            <tr><th><span data-key="mirasci">Mirasçı</span></th><th><span data-key="tutar">Tutar (₺)</span></th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </aside>
    </div>

    <script src="../node_modules/intro.js/minified/intro.min.js"></script>
    <script type="module" src="./ui.js"></script>
  </body>
</html>
